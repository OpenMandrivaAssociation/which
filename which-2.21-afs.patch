diff -Naur which-2.21/bash.c which-2.21.tpg/bash.c
--- which-2.21/bash.c	2015-03-19 18:06:11.000000000 +0000
+++ which-2.21.tpg/bash.c	2015-03-21 10:33:02.669498008 +0000
@@ -34,7 +34,6 @@
  * The following macro's are used in bash, and below:
  */
 #undef SHELL
-#undef AFS
 #undef NOGROUP
 
 /*
@@ -266,7 +265,9 @@
     r |= FS_READABLE;
 
   return r;
-#elif defined (AFS)
+
+    if (getenv("AFS"))
+	{
   /* We have to use access(2) to determine access because AFS does not
      support Unix file system semantics.  This may produce wrong
      answers for non-AFS files when ruid != euid.  I hate AFS. */
@@ -276,7 +277,9 @@
     r |= FS_READABLE;
 
   return r;
-#else /* !AFS */
+       }
+    else
+       { /* !AFS */
 
   /* Find out if the file is actually executable.  By definition, the
      only other criteria is that the file has an execute bit set that
@@ -320,7 +323,8 @@
     }
 
   return r;
-#endif /* !AFS */
+    } /* !AFS */
+#endif
 }
 
 /* From bash-4.3 / general.c / line 604 ; Changes: Using 'strchr' instead of 'mbschr'. */
